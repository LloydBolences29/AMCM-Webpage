import{a as N,u as S,r as t,j as s}from"./index-1y3UAu6N.js";import{M as b}from"./MainLayout-ChZ2Q558.js";import E from"./EKGSpinner-DGu2Bmf4.js";import{C as A}from"./Container-B9Qe7Udh.js";import{F as r}from"./Form-CVo1IMGl.js";import{R as p}from"./Row-DkFBgvvI.js";import{C as f}from"./Col-CLIeRPa0.js";import{A as g}from"./Alert-sowDNKlA.js";import{B as q}from"./Button-DuTH_Hsw.js";import"./Footer-DEjXnE2X.js";/* empty css             */import"./hook-DYuvmNqw.js";import"./extends-CF3RwP-h.js";import"./Anchor-Cs9eccq1.js";import"./Button-D8NJ8Bso.js";const V=()=>{const{loading:P,auth:e,setAuth:j}=N(),i=S(),[a,d]=t.useState({newPassword:"",confirmNewPassword:""}),[c,l]=t.useState(""),[u,x]=t.useState(""),[m,C]=t.useState(!1),y="/api",v=async o=>{if(o.preventDefault(),a.newPassword!==a.confirmNewPassword){l("Passwords do not match");return}try{const n=await fetch(`${y}/auth/change-password`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e.user?.email,newPassword:a.newPassword})}),h=await n.json();n.ok&&(x(h.message),l(""),console.log("Password changed successfully:",h),j(w=>({...w,loading:!1,user:{...w.user,requirePasswordChange:!1}})),C(!0))}catch(n){console.error("Error changing password:",n)}};return t.useEffect(()=>{if(m&&e.isAuthenticated&&!e.user?.requirePasswordChange)switch(e.user?.role){case"admin":i("/admin");break;case"editor":i("/editor");break;default:i("/")}},[m,e.isAuthenticated,e.user?.requirePasswordChange]),console.log("Require password change:",e.user?.role),s.jsx(s.Fragment,{children:s.jsx(b,{children:P?s.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:s.jsx(E,{})}):s.jsxs(A,{children:[s.jsx("div",{children:s.jsx("h2",{children:"Change Your Password"})}),s.jsxs(r,{onSubmit:v,children:[s.jsxs(r.Group,{as:p,className:"mb-3",controlId:"formNewPassword",children:[s.jsx(r.Label,{column:!0,sm:2,children:"New Password"}),s.jsx(f,{sm:10,children:s.jsx(r.Control,{required:!0,type:"password",placeholder:"Enter new password",onChange:o=>d({...a,newPassword:o.target.value})})})]}),s.jsxs(r.Group,{as:p,className:"mb-3",controlId:"formConfirmPassword",children:[s.jsx(r.Label,{column:!0,sm:2,children:"Confirm Password"}),s.jsx(f,{sm:10,children:s.jsx(r.Control,{required:!0,type:"password",placeholder:"Confirm new password",onChange:o=>d({...a,confirmNewPassword:o.target.value})})})]}),c&&s.jsx(g,{variant:"danger",children:c}),u&&s.jsx(g,{variant:"success",children:u}),s.jsx(q,{variant:"outline-primary",type:"submit",children:"Change Password"})]})]})})})};export{V as default};
