import{a as re,r as o,j as e}from"./index-CH27Beym.js";import{T as ae}from"./Table-Da3iA7tR.js";import{a as te,M as l}from"./Footer-D2Q2iCNQ.js";import{B as h}from"./Button-AsRw39wd.js";import{S as M,A as D}from"./Alert-3s0gBCOM.js";import{F as r}from"./Form-BZ0ETNCW.js";import{R as p}from"./Row-T6lLZ6_c.js";import{C as i}from"./Col-1dE1JxJt.js";import{B as ne}from"./Badge-D9zwNTSv.js";import"./Button-Bc2rXTAv.js";import"./ButtonBase-CrX34Rid.js";import"./DefaultPropsProvider-BQFJOVLU.js";import"./extends-CF3RwP-h.js";import"./createSimplePaletteValueFilter-Dh0TRCQ5.js";import"./useSlot-BhEGg-2m.js";import"./getReactElementRef-DYPJPfdo.js";import"./ownerDocument-DW-IO8s5.js";import"./Paper-DCCYYBpF.js";import"./createSvgIcon-DngBmo0W.js";import"./CircularProgress-jb664nPt.js";const Be=()=>{const{auth:U}=re(),N={firstname:"",lastname:"",username:"",email:"",password:"",role:""},[G,O]=o.useState([]),[E,w]=o.useState(!1),[c,j]=o.useState(N),[F,m]=o.useState("idle"),[H,v]=o.useState(!1),[_,u]=o.useState(!1),[k,d]=o.useState(""),[R,f]=o.useState(!1),[a,x]=o.useState({id:"",firstname:"",lastname:"",username:"",email:"",role:""}),[I,$]=o.useState({password:""}),[P,z]=o.useState(null),[A,y]=o.useState(!1),[L,C]=o.useState(!1),[V,T]=o.useState(null),g="/api",J=()=>{w(!0)},q=()=>{w(!1)},K=s=>{z(s),y(!0)},Q=()=>{f(!1),C(!0)},W=s=>{C(!1),f(!0),x(s),T(s)},X=async s=>{s.preventDefault();try{const t=await fetch(`${g}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c),credentials:"include"}),n=await t.json();t.ok?(S(),j(N),m("success"),v(!0),d(n.message),w(!1)):(m("error"),d(n.message),u(!0))}catch(t){console.log("Error Adding User.",t),m("error"),u(!0),d(t.message)}},Y=async s=>{s.preventDefault();const t={};if(Object.keys(a).forEach(n=>{a[n]!==V[n]&&(t[n]=a[n])}),t.id=a.id,Object.keys(t).length<=1){console.log("No changes detected.");return}try{const n=await fetch(`${g}/user/edit-user`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include"}),B=await n.json();console.log("Data: ",B),n.ok?(S(),m("success"),v(!0),d(B.message),f(!1)):(m("error"),u(!0),d(B.message))}catch(n){console.log("Error Saving User.",n),m("error"),u(!0),d(n.message)}},Z=async()=>{const s=P.id;if(!s){console.error("No user selected for deletion."),d("Error: No user selected."),u(!0);return}try{const t=await fetch(`${g}/auth/delete-user/${s}`,{method:"DELETE",credentials:"include"}),n=await t.json();t.ok&&(m("success"),v(!0),d(n.message),y(!1),S())}catch(t){console.log("Error Deleting User.",t),m("error"),u(!0),d(t.message)}},ee=s=>{x(s),T(s),f(!0)},S=async()=>{try{const s=await fetch(`${g}/user/get-users`);if(!s.ok)throw new Error("Failed to fetch users");const t=await s.json();O(t)}catch(s){console.error("Error fetching all users:",s)}},se=async()=>{const s={id:a.id,password:I.password};try{const t=await fetch(`${g}/user/reset-password`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(s)}),n=await t.json();t.ok?(m("success"),v(!0),d(n.message),C(!1)):(m("error"),u(!0),d(n.message))}catch(t){console.log("Error resetting password:",t),m("error"),u(!0),d(t.message)}};o.useEffect(()=>{S()},[]);const b=(s,t)=>{t!=="clickaway"&&(v(!1),u(!1))};return console.log("Users to be deleted: ",P?.id),e.jsxs(e.Fragment,{children:[e.jsx("div",{id:"add-user-container",children:e.jsx("div",{id:"add-user-wrapper",children:e.jsx("div",{id:"add-user-button",children:e.jsx(h,{variant:"outline-primary",onClick:J,children:"Add User"})})})}),F==="success"?e.jsx(M,{open:H,autoHideDuration:5e3,onClose:b,children:e.jsx(D,{onClose:b,severity:"success",variant:"filled",sx:{width:"100%",margin:"1em",fontSize:"1em"},children:k})}):e.jsx(M,{open:_,autoHideDuration:5e3,onClose:b,children:e.jsx(D,{onClose:b,severity:"error",variant:"filled",sx:{width:"100%",margin:"1em",fontSize:"1em"},children:k})}),e.jsxs(ae,{striped:!0,bordered:!0,hover:!0,responsive:!0,variant:"light",className:"my-4 shadow-sm rounded",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Username"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:G.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.id}),e.jsx("td",{children:s.username}),e.jsx("td",{children:s.email}),e.jsx("td",{children:s.role}),e.jsx("td",{children:U.user&&U.user.id!==s.id&&e.jsxs("div",{children:[e.jsx(h,{variant:"outline-primary",size:"sm",className:"me-2",onClick:()=>ee(s),children:"Edit"}),e.jsx(h,{variant:"outline-danger",size:"sm",className:"me-2",onClick:()=>K(s),children:e.jsx(te,{})})]})})]},s.id))})]}),E&&e.jsxs(l,{show:E,onHide:()=>w(!1),children:[e.jsx(l.Header,{closeButton:!0,children:e.jsx(l.Title,{children:"Add a User"})}),e.jsx(l.Body,{children:e.jsxs(r,{onSubmit:X,children:[e.jsxs(p,{className:"mb-3",children:[e.jsx(i,{children:e.jsxs(r.Group,{controlId:"formBasicUsername",children:[e.jsx(r.Label,{children:"First name"}),e.jsx(r.Control,{type:"text",placeholder:"Please enter firstname",value:c.firstname,onChange:s=>{j({...c,firstname:s.target.value})}})]})}),e.jsx(i,{children:e.jsxs(r.Group,{controlId:"formBasicRole",children:[e.jsx(r.Label,{children:"Last name"}),e.jsx(r.Control,{type:"text",placeholder:"Please enter lastname",value:c.lastname,onChange:s=>{j({...c,lastname:s.target.value})}})]})})]}),e.jsxs(p,{className:"mb-3",children:[e.jsx(i,{children:e.jsxs(r.Group,{controlId:"formBasicUsername",children:[e.jsx(r.Label,{children:"Username"}),e.jsx(r.Control,{type:"text",placeholder:"Please enter a username",value:c.username,onChange:s=>{j({...c,username:s.target.value})}})]})}),e.jsx(i,{children:e.jsxs(r.Group,{controlId:"formBasicRole",children:[e.jsx(r.Label,{children:"Role"}),e.jsxs(r.Control,{as:"select",value:c.role,onChange:s=>j({...c,role:s.target.value}),children:[e.jsx("option",{value:"",children:"Select a Role"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"editor",children:"Editor"}),e.jsx("option",{value:"viewer",children:"Viewer"})]})]})})]}),e.jsxs(p,{className:"mb-3",children:[e.jsx(i,{children:e.jsxs(r.Group,{controlId:"formBasicEmail",children:[e.jsx(r.Label,{children:"Email:"}),e.jsx(r.Control,{type:"email",name:"email",placeholder:"Please enter your email",value:c.email,onChange:s=>{j({...c,email:s.target.value})}})]})}),e.jsx(i,{children:e.jsxs(r.Group,{controlId:"formBasicPassword",children:[e.jsx(r.Label,{children:"Password:"}),e.jsx(r.Control,{type:"password",placeholder:"Please enter your password",value:c.password,onChange:s=>{j({...c,password:s.target.value})}})]})})]}),e.jsx(h,{className:"mx-1",variant:"secondary",onClick:q,children:"Close"}),e.jsx(h,{className:"mx-1",variant:"primary",type:"submit",children:"Save Changes"})]})})]}),A&&e.jsxs(l,{show:A,onHide:()=>y(!1),children:[e.jsx(l.Header,{closeButton:!0,children:e.jsx(l.Title,{children:"Delete User"})}),e.jsxs(l.Body,{children:[e.jsxs("p",{children:["Are you sure you want to delete user ",P?.username,"?"]}),e.jsx(h,{className:"mx-1",variant:"secondary",onClick:()=>y(!1),children:"Cancel"}),e.jsx(h,{className:"mx-1",variant:"danger",onClick:Z,children:"Delete"})]})]}),R&&e.jsxs(l,{show:R,onHide:()=>f(!1),children:[e.jsx(l.Header,{closeButton:!0,children:e.jsx(l.Title,{children:"Edit User"})}),e.jsx(l.Body,{children:e.jsxs(r,{onSubmit:Y,children:[e.jsxs(p,{className:"mb-3",children:[e.jsx(i,{children:e.jsxs(r.Group,{controlId:"formBasicUsername",children:[e.jsx(r.Label,{children:"First name"}),e.jsx(r.Control,{type:"text",placeholder:"Please enter firstname",value:a?a.firstname:"",onChange:s=>{x({...a,firstname:s.target.value})}})]})}),e.jsx(i,{children:e.jsxs(r.Group,{controlId:"formBasicRole",children:[e.jsx(r.Label,{children:"Last name"}),e.jsx(r.Control,{type:"text",placeholder:"Please enter last name",value:a?a.lastname:"",onChange:s=>{x({...a,lastname:s.target.value})}})]})})]}),e.jsxs(p,{className:"mb-3",children:[e.jsx(i,{children:e.jsxs(r.Group,{controlId:"formBasicUsername",children:[e.jsx(r.Label,{children:"Username"}),e.jsx(r.Control,{type:"text",placeholder:"Please enter a username",value:a?a.username:"",onChange:s=>{x({...a,username:s.target.value})}})]})}),e.jsx(i,{children:e.jsxs(r.Group,{controlId:"formBasicRole",children:[e.jsx(r.Label,{children:"Role"}),e.jsxs(r.Control,{as:"select",value:a?a.role:"",onChange:s=>x({...a,role:s.target.value}),children:[e.jsx("option",{value:"",children:"Select a Role"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"editor",children:"Editor"}),e.jsx("option",{value:"viewer",children:"Viewer"})]})]})})]}),e.jsxs(p,{className:"mb-3",children:[e.jsx(i,{children:e.jsxs(r.Group,{controlId:"formBasicEmail",children:[e.jsx(r.Label,{children:"Email:"}),e.jsx(r.Control,{type:"email",name:"email",placeholder:"Please enter your email",value:a?a.email:"",onChange:s=>{x({...a,email:s.target.value})}})]})}),e.jsx(i,{children:e.jsxs(r.Group,{controlId:"formBasicIsActive",children:[e.jsx(r.Label,{children:"Active Status:"}),e.jsxs(r.Control,{as:"select",value:a&&a.is_active!==void 0?a.is_active:"",onChange:s=>{x({...a,is_active:s.target.value})},children:[e.jsx("option",{value:"",children:"Select Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]})})]}),e.jsxs(p,{className:"mb-3",children:[e.jsx(i,{children:e.jsxs(r.Group,{children:[e.jsx(r.Label,{children:"Lock Status:"}),e.jsx(r.Check,{type:"switch",id:"custom-switch",checked:a?a.is_locked:!1,onChange:s=>{x({...a,is_locked:s.target.checked})}})]})}),e.jsx(i,{children:e.jsx(r.Group,{children:e.jsx(h,{variant:"outline-danger",style:{fontSize:"0.9rem"},onClick:Q,children:"Reset Account Password"})})})]}),e.jsx(h,{className:"mx-1",variant:"secondary",onClick:()=>f(!1),children:"Close"}),e.jsx(h,{className:"mx-1",variant:"primary",type:"submit",children:"Save Changes"})]})})]}),L&&e.jsxs(l,{show:L,onHide:()=>C(!1),children:[e.jsx(l.Header,{closeButton:!0,children:e.jsxs(l.Title,{children:["Reset Password for ",a?a.username:""]})}),e.jsxs(l.Body,{children:[e.jsxs("div",{className:"instruction-div",children:[e.jsx(ne,{bg:"info",children:"Info"}),e.jsx("span",{className:"instruction-text",children:" Please enter a new password for the user account. The user will be required to change this password upon their next login. "})]}),e.jsx(r,{children:e.jsxs(r.Group,{controlId:"formBasicPassword",children:[e.jsx(r.Label,{children:"New Password:"}),e.jsx(r.Control,{type:"password",placeholder:"Please enter new password",onChange:s=>$({...I,password:s.target.value})})]})})]}),e.jsxs(l.Footer,{children:[e.jsx(h,{className:"mx-1",variant:"secondary",onClick:()=>W(a.id),children:"Close"}),e.jsx(h,{className:"mx-1",variant:"outline-danger",onClick:se,children:"Reset Password"})]})]})]})};export{Be as default};
