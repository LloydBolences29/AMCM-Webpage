import{a as N,u as S,r as t,j as s}from"./index-DlVAgkeO.js";import{M as b}from"./MainLayout-DCJjboZG.js";import E from"./EKGSpinner-jsDVy4ND.js";import{C as T}from"./Container-BPTqTy8U.js";import{F as r}from"./Form-B6uVeF9r.js";import{R as f}from"./Row-BmoNzbsl.js";import{C as g}from"./Col-DbWGna5v.js";import{A as P}from"./Alert-ka1to_mB.js";import{B as A}from"./Button-BwE_hpmx.js";import"./Footer-DvhtKQwl.js";/* empty css             */import"./hook-CsEs8zmU.js";import"./extends-CF3RwP-h.js";import"./Anchor-BIOSxkaL.js";import"./Button-DxlEX406.js";const V=()=>{const{loading:j,auth:e,setAuth:x}=N(),i=S(),[o,c]=t.useState({newPassword:"",confirmNewPassword:""}),[u,d]=t.useState(""),[l,m]=t.useState(""),[h,C]=t.useState(!1),y="/api",v=async a=>{if(a.preventDefault(),o.newPassword!==o.confirmNewPassword){d("Passwords do not match"),setTimeout(()=>{d("")},3200);return}try{const n=await fetch(`${y}/auth/change-password`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e.user?.email,newPassword:o.newPassword})}),w=await n.json();n.ok&&(m(w.message),setTimeout(()=>{m(""),d("")},3500),console.log("Password changed successfully:",w),x(p=>({...p,loading:!1,user:{...p.user,requirePasswordChange:!1}})),C(!0))}catch(n){console.error("Error changing password:",n)}};return t.useEffect(()=>{if(h&&e.isAuthenticated&&!e.user?.requirePasswordChange)switch(e.user?.role){case"admin":setTimeout(()=>{i("/admin")},3700);break;case"editor":setTimeout(()=>{i("/editor")},3700);break;default:setTimeout(()=>{i("/")},3700)}},[h,e.isAuthenticated,e.user?.requirePasswordChange]),console.log("Require password change:",e.user?.role),s.jsx(s.Fragment,{children:s.jsx(b,{children:j?s.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:s.jsx(E,{})}):s.jsxs(T,{children:[s.jsx("div",{children:s.jsx("h2",{children:"Change Your Password"})}),s.jsxs(r,{onSubmit:v,children:[s.jsxs(r.Group,{as:f,className:"mb-3",controlId:"formNewPassword",children:[s.jsx(r.Label,{column:!0,sm:2,children:"New Password"}),s.jsx(g,{sm:10,children:s.jsx(r.Control,{required:!0,type:"password",placeholder:"Enter new password",onChange:a=>c({...o,newPassword:a.target.value})})})]}),s.jsxs(r.Group,{as:f,className:"mb-3",controlId:"formConfirmPassword",children:[s.jsx(r.Label,{column:!0,sm:2,children:"Confirm Password"}),s.jsx(g,{sm:10,children:s.jsx(r.Control,{required:!0,type:"password",placeholder:"Confirm new password",onChange:a=>c({...o,confirmNewPassword:a.target.value})})})]}),u&&s.jsx(P,{variant:"danger",children:u}),l&&s.jsx(P,{variant:"success",children:l}),s.jsx(A,{variant:"outline-primary",type:"submit",children:"Change Password"})]})]})})})};export{V as default};
